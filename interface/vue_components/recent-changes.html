<style>
div.card-header {
    padding:5px;
}
div.card {
    margin-bottom:1rem;
}
</style>

<template id='recent-changes-page-template'>
<div class='container'>
	<tool-navbar>
            <template slot='right'>
                    <widar></widar>
            </template>
    </tool-navbar>
    <div v-if='loaded'>
        <catalog-header :catalog_q='catalog_q'></catalog-header>
        <div>
            <entry v-for='entry in entries' :q='entry.q' :key='entry.q'></entry>
            {{entries}}
        </div>
    </div>
    <div v-else>
        <i>Loading...</i>
    </div>
</div>
</template>

<script>
'use strict';

let RecentChangesPage = Vue.extend ( {
    props : [ 'catalog_q' ] ,
    data : function () { return { loaded:false , entries:[] } } ,
    created : function () {
        let me = this ;
        me.loaded = false ;
        Promise.all ( [
            new Promise(function(resolve, reject) { // stats.auto
                wd.loadSPARQL ( 
                    'SELECT ?q ?d { ?q wdt:'+_props.catalog+' wd:'+me.catalog_q+' ; schema:dateModified ?d } ORDER BY DESC(?d) LIMIT 50' ,
                    function ( d ) {
                        let to_load = [] ;
                        $.each ( d.results.bindings , function ( dummy , b ) {
                            let q = b.q.value.replace(/^.+\//,'') ;
                            me.entries.push ( { q:q , ts:b.d.value } ) ;
                            to_load.push ( q ) ;
                        } ) ;
                        wd.getItemBatch ( to_load , resolve ) ;
                    } )
            } ) ,
        ] ) .then ( () => {
            me.loaded = true ;
        } ) ;
    } ,
    updated : function () { tt.updateInterface(this.$el) ; } ,
    mounted : function () { tt.updateInterface(this.$el) ; } ,
    methods : {
    },
    template:'#recent-changes-page-template'
} ) ;
</script>
